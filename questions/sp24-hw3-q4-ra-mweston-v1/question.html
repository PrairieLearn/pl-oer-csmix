<pl-question-panel>

  <p>Given the following database schema: </p>
  <pre>
Students (<u>NetId</u>, FirstName, LastName, Department)
Enrollments (<u>NetId</u>, <u>CRN</u>, Credits, Score)
Courses (<u>CRN</u>, Title, Department, Instructor)</pre>
  

  <p>
    Write the relational algebra expression for the following query:

  </p>

  <!-- EDIT THIS PART TO CREATE A NEW INSTANCE -->
  <ul><li> Returns the first and last name of CS students that recieved a score below 90 in an ECE course.</li></ul>
  <!-- EDIT THIS PART TO CREATE A NEW INSTANCE -->

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" integrity="sha512-KfkfwYDsLkIlwQp6LFnl8zNdLGxu9YAA1QvwINks4PhcElQSvqcyVLLD9aMhXd13uQjoXtEKNosOWaZqXgel0g==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <div class="accordion" id="instructions">
    <div class="card">
      <div class="card-header" id="headingOne">
        <h2 class="mb-0">
          <button class="btn btn-link btn-block text-left" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne"
            onclick="$('#arrow').toggleClass('fa-arrow-down fa-arrow-right')">
            <i id="arrow" class="fa-solid fa-arrow-down"></i> Formatting Instructions (Click to expand/collapse)
          </button>
        </h2>
      </div>
  
      <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#instructions">
        <div class="card-body" style="padding: 0;">
          <div class="alert alert-warning" role="alert">
            [] is used to indicate format. It should not be included in the query. <br>
            <strong>Commands:</strong>
        
            <ul>
            <li><b>select</b>: \\s_{<code><i>[selection constraint]</i></code>}(<code><i>[relation to select from]</i></code>)
                <br>Example: <code style="color:blue">\s_{FirstName=Sam}(Students)</code> selects Students having first name as Sam.
            </li>
            <li><b>project:</b> \\project_{ <code><i>[attribute1,attribute2...]</i></code> }( <code><i>[relation to project from]</i></code> )
                <br>Example: <code style="color:blue">\project_{NetId,FirstName}(\s_{FirstName=Sam}(Students))</code> selects NetId of Students with first name Sam.
            </li>
        
            <hr>
        
            <li><b>and</b>: (<code><i>[constraint]</i></code>) and (<code><i>[constraint]</i></code>)</li>
            <li><b>or</b>: (<code><i>[constraint]</i></code>) or (<code><i>[constraint]</i></code>)</li>
            <li><b>not</b>: not (<code><i>[constraint]</i></code>)</li>
        
            <hr>
        
            <li><b>equal</b>: <code><i>[attribute]</i></code> = <code><i>[attribute / value]</i></code> </li>
            <li><b>not_equal</b>: <code><i>[attribute]</i></code> != <code><i>[attribute / value]</i></code> </li>
            <li><b>not_equal_alt</b>: <code><i>[attribute]</i></code> <> <code><i>[attribute / value]</i></code> </li>
            <li><b>less_than</b>: <code><i>[attribute]</i></code> < <code><i>[attribute / value]</i></code> </li>
            <li><b>less_than_equal</b>: <code><i>[attribute]</i></code> <= <code><i>[attribute / value]</i></code> </li>
            <li><b>greater_than</b>: <code><i>[attribute]</i></code> > <code><i>[attribute / value]</i></code> </li>
            <li><b>greater_than_equal</b>: <code><i>[attribute]</i></code> >= <code><i>[attribute / value]</i></code> </li>
         
            <hr>
        
            <li><b>rename</b>: \\r_{<code><i>[new name]</i></code>}(<code><i>[old name]</i></code>)
                Use this to rename a relation.
                <br>Example: <code>\r_{S1}(Students)</code> acts like "(SELECT * FROM Students) AS S1"
            </li>
            <li><b>assign</b>: <code><i>[relation name]</i></code> \\leftarrow <code><i>[Expression]</i></code> Use this to assign an expression to a variable.
                <br>Example: <code>R1 \leftarrow Students \natural_join Enrollments</code>.
            </li>
        
            <hr>
        
            <li><b>cross_product</b>: <code><i>[relation1]</i></code>  \\j  <code><i>[relation2]</i></code>  </li>
            <li><b>natural_join</b>: <code><i>[relation1]</i></code> \\natural_join <code><i>[relation2]</i></code> </li>
            <li><b>theta_join</b>: <code><i>[relation1]</i></code>  \\theta_join_{<code><i>relation1.attribute1 = relation2.attribute2</i></code>} <code><i>[relation2]</i></code> </li>
            <li><b>left_outer_join</b>: <code><i>[relation1]</i></code>  \\leftouterjoin  <code><i>[relation2]</i></code>  </li>
        
            <hr>
        
            <li><b>union</b>: (<code><i>relation to union</i></code>) + (<code><i>relation to union</i></code>) </li>
            <li><b>difference</b>: (<code><i>relation to subtract from</i></code>) - (<code><i>relation to subtract</i></code>)  </li>
            
            <hr>
        
            <li><b>params_start</b>: {</li>
            <li><b>params_stop</b>: }</li>
            <li><b>paren_left</b>: (</li>
            <li><b>paren_right</b>: )</li>
            </ul>

            <hr>

            <b>Note</b>: To help you debug, if your relational algebra query has no syntax errors, it will be translated to an SQL
            query and that SQL query will be shown after every submission. This query will always have "SELECT DISTINCT"
            and "ORDER BY" clauses. Do not worry about them.
        </div>
      </div>
    </div>
    </div>
  </div>

  <div class="alert alert-primary">
      <b>Example</b><br>

      The following relational algebra query returns the NetId of Students whose FirstName is 'Abdu' and LastName is 'Alawini'.<br>
      <ul>
          <li><code>\project_{NetId}(\s_{FirstName='Abdu' and LastName='Alawini'} (Students) );</code></li>
      </ul>

      Note that ";" is needed at the end of query.<br>
      Try pasting this in the text box below to get started.
  </div>
      
    <div id="relAlgRendererContainr">
      <b>Your relational algebra query will be rendered below:</b>
      <div id="relAlgRenderer" style="overflow-x: auto"></div>
    </div>
    <pl-file-editor file-name="query.sql" ace-mode="ace/mode/text"></pl-file-editor>
  
    <script type="text/javascript">
      function transformQuery(query) {
        query2 = "";
        for (let q of query.split("\n")) {
          query2 += "$$" + q + "$$";
        }
        console.log(query2);
        query = query2.replaceAll("\\project_", "\\Pi_")
                     .replaceAll("\\s_", "\\sigma_")
                     .replaceAll(" and ", " \\land ")
                     .replaceAll(" or ", " \\lor ")
                     .replaceAll(" \\j ", " \\times ")
                     .replaceAll(" \\natural_join ", " \\bowtie ")
                     .replaceAll(" \\theta_join_", " \\bowtie_")
                     .replaceAll("\\r_", "\\rho_")
                     ;
        return query;
      }
    
      // let loaded = 0;
      window.addEventListener('load', function () {
        let elems = document.getElementsByClassName("ace_editor");
        console.log(elems);
        if (elems.length == 1) {
          let inputElem = elems[0];
          let inputEditor = inputElem.env.editor;
          let outputElem = document.getElementById("relAlgRenderer");
    
          function render() {
            MathJax.texReset();
            MathJax.typesetClear();
    
            let query = transformQuery(inputEditor.getValue());
            outputElem.innerHTML = query;
            MathJax.typesetPromise([outputElem]).catch(function (err) {
                outputElem.innerHTML = '';
                outputElem.appendChild(document.createTextNode(err.message));
                console.error(err);
            }).then(function () {
                // console.log("Rendered");
            });
          }
          inputEditor.addEventListener('change', render);
          render();
        }
    
      });
    
    
    </script>
  </pl-question-panel>
  
  <pl-submission-panel>
    <pl-file-preview></pl-file-preview>
    <pl-external-grader-results></pl-external-grader-results>
  </pl-submission-panel>
  